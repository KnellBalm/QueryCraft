# QueryCraft Patch Notes

> **λ©μ **: TODO Listμ—μ„ μ™„λ£λ μ‘μ—…λ“¤μ„ μ•„μΉ΄μ΄λΈν•κ³ , μ„λΉ„μ¤μ λ°μ „ κ³Όμ •μ„ κΈ°λ΅ν•λ” λ¬Έμ„μ…λ‹λ‹¤.

---

### 2026-01-20 (μ„±μ  μ—°λ™ μ •ν•©μ„± ν™•λ³΄ λ° μ•μ •ν™”)
- **μ„±μ  μ‹μ¤ν… κ°μ„ **: `stats_service.py`κ°€ μ‹¤μ‹κ°„ κ³„μ‚° λ€μ‹  `users` ν…μ΄λΈ”μ `xp`, `level` κ°’μ„ μ°μ„  μ‚¬μ©ν•λ„λ΅ λ³€κ²½ν•μ—¬ κ΄€λ¦¬μ νμ΄μ§€μ™€ κ°’ μΌμΉ
- **μ—”μ§„ μ•μ •ν™”**: `PostgresEngine`μ— `fetch_one`, `fetch_all` λ“± μΈν„°νμ΄μ¤ λ³΄μ™„ν•μ—¬ DuckDB μ—”μ§„κ³Όμ νΈν™μ„± ν™•λ³΄
- **ν•μ„ νΈν™μ„±**: `daily_challenge_writer.py`μ— κµ¬ν•(v1.0) λ°μ΄ν„° μλ™ λ³€ν™(v2.0) λ΅μ§ μ¶”κ°€
- **ν”„λ΅ νΈμ—”λ“ λ°©μ–΄**: `DailyChallenge.tsx`μ— Optional Chaining μ μ©ν•μ—¬ λ°μ΄ν„° λ―ΈλΉ„ μ‹ λ°νƒ€μ„ μ—λ¬ λ°©μ§€

### 2026-01-19 (ν†µν•© Generator μ•„ν‚¤ν…μ² λ„μ…)
κµ¬μ¶• μ™„λ£

### π Backend: ν†µν•© λ¬Έμ  μƒμ„± μ—”μ§„
- **λ‹¨μΌ μ—”νΈλ¦¬ ν¬μΈνΈ**: `problems.generator.generate(mode="pa"|"stream"|"rca")` ν†µν•© μΈν„°νμ΄μ¤ κµ¬ν„
- **ν”„λ΅¬ν”„νΈ μ‹μ¤ν… ν†µν•©**:
  - `problems/prompt.py`μ— modeλ³„ λ™μ  ν”„λ΅¬ν”„νΈ μ„ νƒ λ΅μ§ μ¶”κ°€
  - `problems/prompt_stream.py` μƒμ„±: Stream λ°μ΄ν„° μ”μ•½ λ° ν”„λ΅¬ν”„νΈ λ΅μ§ μ΄λ™
  - PA/Stream/RCA λ¨λ‘ λ‹¨μΌ `build_prompt(mode)` νΈμ¶λ΅ μ²λ¦¬
- **λ™μ  μ„ΈνΈ μ κ΄€λ¦¬**: PAλ” 2μ„ΈνΈ(12λ¬Έμ ), Stream/RCAλ” 1μ„ΈνΈ(6λ¬Έμ ) μλ™ κ²°μ •
- **ν•μ„ νΈν™μ„±**: `generator_stream.py`μ— deprecated κ²½κ³  μ¶”κ°€, κΈ°μ΅΄ μ½”λ“ μ μ§€

### π›΅οΈ μ•μ •μ„± λ° Cloud Run μµμ ν™”
- **νμΌ κ²½λ΅ μ—λ¬ μ›μ² μ°¨λ‹¨**:
  - `ensure_dir()` ν—¬νΌ ν•¨μλ΅ λ””λ ‰ν† λ¦¬ μƒμ„± λ³΄μ¥
  - `safe_save_json()` ν•¨μλ΅ νμΌ μ €μ¥ μ‹¤ν¨ μ‹ warning μ²λ¦¬ (μ¤‘λ‹¨ν•μ§€ μ•μ)
  - DB μ €μ¥ μ‹¤ν¨ μ‹μ—λ„ νμΌ μ €μ¥ μ‹λ„ν•μ—¬ λ°μ΄ν„° μ†μ‹¤ λ°©μ§€
- **Cloud Run ν™κ²½ λ€μ‘**:
  - `K_SERVICE` ν™κ²½ λ³€μλ΅ Cloud Run κ°μ§€
  - νλ°μ„± νμΌ μ‹μ¤ν…μ—μ„λ„ μ•μ •μ  λ™μ‘ (DB-first μ•„ν‚¤ν…μ²)
  - PostgreSQLμ„ Primary Sourceλ΅ λ…μ‹

### π”§ κ΄€λ¦¬μ API ν†µν•©
- **`/admin/trigger/daily-generation`**: ν†µν•© generator μ‚¬μ© (PA + Stream μμ°¨ μƒμ„±)
- **`/admin/generate-problems`**: λ¨λ“  mode (pa/stream/rca) λ‹¨μΌ μ—”λ“ν¬μΈνΈλ΅ ν†µν•©
- **`/admin/trigger-now`**: ν†µν•© μƒμ„± νμ΄ν”„λΌμΈ (λ°μ΄ν„° + PA + Stream)

### π“ ν”„λ΅ νΈμ—”λ“ ν†µν•© μƒνƒ ν™•μΈ
- **μ΄λ―Έ ν†µν•© μ™„λ£ ν™•μΈ**:
  - App.tsx: Track κΈ°λ° λ„¤λΉ„κ²μ΄μ… (Core Skills β†” Future Lab)
  - MainPage.tsx: "μ¤λμ μΌμΌ λ¶„μ„" λ‹¨μΌ μΉ΄λ“ (PA + STREAM νƒκ·Έ)
  - /pa, /stream κ°λ³„ λ©”λ‰΄ μ—†μ (legacy redirect μ μ§€)

### π“ κΈ°μ  λ¶€μ±„ μ •λ¦¬
- **μ½”λ“ μ¤‘λ³µ μ κ±°**: `get_expected_result()`, `save_problems_to_db()` μ¤‘λ³µ μ κ±°
- **μΌκ΄€λ λ„¤μ΄λ°**: mode νλΌλ―Έν„° ν‘μ¤€ν™” ("pa"|"stream"|"rca")
- **λ§μ΄κ·Έλ μ΄μ… κ°€μ΄λ“**: κΈ°μ΅΄ μ½”λ“ β†’ ν†µν•© generator μ „ν™ κ°€μ΄λ“ μ κ³µ

---

## [2026-01-18] μ„λΉ„μ¤ μ•μ •ν™” λ° UI κ°μ„ 
### π” λ³΄μ• λ° λ΅μ»¬ ν™κ²½ μ•μ •ν™”
- **Supabase DB μ—°κ²° μ΄μ ν•΄κ²°**: IPv6 λ―Έμ§€μ› ν™κ²½μ„ μ„ν• Connection Pooler (`aws-1-ap-northeast-2`) μ—°λ™ μ„±κ³µ.
- **μΈμ¦ μ‹μ¤ν…**: κ΄€λ¦¬μ κ³„μ •(`admin@querycraft.kr`) μƒμ„± λ° λ΅κ·ΈμΈ κΈ°λ¥ μ •μƒν™”.
- **λ°±μ—”λ“ λ΅κΉ…**: λ΅κ·Έ ν΄λ” κ¶ν• μ¤λ¥(`Permission denied`) ν•΄κ²° λ° μ•μ •ν™”.
- **DB μµμ ν™”**: Supabase μ ‘μ† μ„Έμ… ν¨μ¨ν™” (`maxconn=5`).

### π¨ ν”„λ΅ νΈμ—”λ“ UI/UX
- **GNB λ©”λ‰΄ μ •λ¦¬**: "μ¤λμ ν•™μµ" λ“λ΅­λ‹¤μ΄μ„ μ κ±°ν•κ³  Daily Challenge μ ‘κ·Όμ„± κ°•ν™”.
- **λ΅κ·ΈμΈ μ¤λ¥ μμ •**: Nginx ν”„λ°νΈμ—”λ“ ν”„λ΅μ‹ μ„¤μ • μ¤λ¥(API ν”„λ¦¬ν”½μ¤ μ μ‹¤) μμ •.

---

## [2026-01-17] Daily Challenge μ‹μ¤ν… κµ¬μ¶• λ° Cloud Scheduler μ—°λ™
### π—“οΈ Daily Challenge MVP (95% μ™„λ£)
- **Backend**: μ‹λ‚λ¦¬μ¤, λ°μ΄ν„°, λ¬Έμ  μλ™ μƒμ„± μ—”μ§„(`scenario_generator` λ“±) κµ¬ν„.
- **API**: `/api/daily/*` μ—”λ“ν¬μΈνΈ 5μΆ… κµ¬μ¶•.
- **Frontend**: ScenarioPanel λ° DailyChallenge μ „μ© νμ΄μ§€ κ°λ°.
- **Worker**: λ°°ν¬ ν¨μ¨μ„ μ„ν• ν†µν•© λΉλ“ μΈν”„λΌ κµ¬μ¶•.

### β° Cloud Scheduler & μ¤μΌ€μ¤„λ¬ κ°μ„ 
- **GCP μ—°λ™**: Cloud Scheduler (`querycraft-daily-generation`) μƒμ„± λ° OIDC μΈμ¦ μ„¤μ •.
- **μ—”λ“ν¬μΈνΈ**: `/admin/schedule/run`μ„ ν†µν• κ°•μ  μ‹¤ν–‰ λ° μλ™ν™” λ΅μ§ κµ¬ν„.
- **μ•μ •μ„±**: `ENABLE_SCHEDULER` ν™κ²½λ³€μ μ μ–΄ λ° μ¤‘λ³µ μ‹¤ν–‰ λ°©μ§€ κΈ°λ¥ μ¶”κ°€.

---

## [2026-01-16] μ΄κΈ° λ³΄μ• κ°•ν™” λ° μΈν”„λΌ κµ¬μ¶•
### π›΅οΈ λ³΄μ• ν•µμ‹¬
- **λΉ„λ°€λ²νΈ μ •μ±…**: μµμ† 8μ, λ€μ†λ¬Έμ/μ«μ/νΉμλ¬Έμ μ΅°ν•© ν•„μν™”.
- **μΈμ¦ λ³΄μ•**: Rate Limiting (10λ¶„ λ‚΄ 5ν μ‹¤ν¨ μ‹ μ°¨λ‹¨) κµ¬ν„.
- **ν…μ¤νΈ**: λ°±μ—”λ“ μ λ‹› ν…μ¤νΈ 101κ° μ „ ν•­λ© ν†µκ³Ό λ‹¬μ„±.

### π“ λ¶„μ„ νΈλν‚Ή
- **Mixpanel**: AI μ‚¬μ© μ„κ³„μΉ μ΄λ²¤νΈ νΈλν‚Ή μ¶”κ°€ λ° κΈ°μ΄ μ„¤κ³„ μ™„λ£.

---

## [μ΄μ „ λ‚΄μ—­]
- API μ—λ¬ ν•΄κ²° (Leaderboard 500, Recommend 400, Translate 404 ν•΄κ²°)
- Phase 1 & 2 ν•µμ‹¬ λ΅μ§ κΈ°λ° κµ¬μ¶• μ™„λ£

---
*λ§μ§€λ§‰ μ—…λ°μ΄νΈ: 2026-01-19*
