<<<<<<< HEAD

# QueryCraft ê¸°ëŠ¥ ê°œì„  ë° ìµœì í™” ê³„íš (2026-01-13)

## ê°œìš”
ë°°í¬ ì•ˆì •ì„± í™•ë³´, UI/UX ê³ ë„í™”, ê·¸ë¦¬ê³  ì±„ì  ë° ë°ì´í„° ìƒì„± ë¡œì§ì˜ ìµœì í™”ë¥¼ ëª©í‘œë¡œ í•¨.

## ì£¼ìš” ë³€ê²½ ì‚¬í•­

### 1. ë°°í¬ ë° ì•ˆì •ì„± (Stability)
- **ì„í¬íŠ¸ ì˜¤ë¥˜ ìˆ˜ì •**: `problems.py`ì—ì„œ `TableSchema`, `get_table_schema` ëˆ„ë½ í•´ê²°.
- **ìŠ¤í‚¤ë§ˆ ë³´ì™„**: `backend/schemas/stats.py`ë¥¼ ì‹ ê·œ ìƒì„±í•˜ì—¬ `UserStats`, `LevelInfo` ëª¨ë¸ ì •ì˜.
- **Docker ë¹Œë“œ ê²€ì¦**: ë¡œì»¬ í™˜ê²½ì—ì„œ Docker ë¹Œë“œ ë° ì•± ë¡œë“œ ì—¬ë¶€ ìë™ í…ŒìŠ¤íŠ¸ í”„ë¡œì„¸ìŠ¤ ì ìš©.

### 2. UI/UX ê°œì„ 
- **ê²½í—˜ì¹˜ ë°”(XP Bar) ê³ ë„í™”**: í—¤ë”ì— í˜„ì¬ ê²½í—˜ì¹˜/ë‹¤ìŒ ë ˆë²¨ ì„ê³„ì¹˜(ì˜ˆ: 45/100)ë¥¼ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œí•˜ê³ , ê²Œì´ì§€ ë°”ì˜ ë„ˆë¹„ë¥¼ í™•ì¥í•˜ì—¬ ê°€ë…ì„± ê°œì„ .
- **íˆ´íŒ ê¸°ë°˜ ì•ˆë‚´**: "ë¼ì´íŠ¸ ëª¨ë“œ", "ìŠ¤íŠ¸ë¦¼ ë¶„ì„" ë“± ë¯¸êµ¬í˜„ ê¸°ëŠ¥ í´ë¦­ ì‹œ íŒì—…(alert) ëŒ€ì‹  íˆ´íŒ ì•ˆë‚´ë¡œ ë³€ê²½í•˜ê³  í´ë¦­ ì´ë²¤íŠ¸ ë¹„í™œì„±í™”.
- **ë¸Œëœë”© ë¦¬í”„ë ˆì‹œ**: ë¡œê³  ë° GNB ë©”ë‰´ ì•„ì´ì½˜ì„ í˜„ëŒ€ì ì¸ ì´ëª¨ì§€ë¡œ êµì²´.
  - ë¡œê³ : ğŸ”§ -> ğŸš€
  - PA ì—°ìŠµ -> ğŸ“ˆ PA ë¶„ì„
  - ìŠ¤íŠ¸ë¦¼ ì—°ìŠµ -> ğŸ“¡ ìŠ¤íŠ¸ë¦¼ ë¶„ì„
  - ë¬´í•œ ì—°ìŠµ -> â™¾ï¸ ë¬´í•œ ì—°ìŠµ

### 3. ì±„ì  ë° ë°ì´í„° ìµœì í™” (Optimization)
- **ë‚ ì§œ ë¹„êµ ê´€ëŒ€í™”**: ì±„ì  ì‹œ `yyyy-mm-dd`ì™€ `yyyy-mm-dd hh:mm:ss` í˜•ì‹ì„ ëª¨ë‘ `date` ë ˆë²¨ì—ì„œ ë¹„êµí•˜ë„ë¡ ìˆ˜ì •í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì˜¤ë‹µ ë°©ì§€.
- **ìŠ¤í‚¤ë§ˆ ìµœì í™”**: `pa_users.signup_at` ë° `pa_orders.order_time` ì»¬ëŸ¼ íƒ€ì…ì„ `TIMESTAMP`ì—ì„œ `DATE`ë¡œ ë³€ê²½í•˜ì—¬ ë°ì´í„° ì¼ê´€ì„± í™•ë³´.
- **ë¬¸ì œ ìƒì„± í”„ë¡¬í”„íŠ¸ ìˆ˜ì •**: Geminiì—ê²Œ ì œê³µë˜ëŠ” ë°ì´í„° ìš”ì•½ ì •ë³´ì—ì„œ ë³€ê²½ëœ DATE íƒ€ì…ì„ ëª…ì‹œí•˜ë„ë¡ ì—…ë°ì´íŠ¸.

### 4. ê´€ë¦¬ì ë° ìŠ¤ì¼€ì¤„ëŸ¬ ê¸°ëŠ¥
- **PA ì „ìš© ìŠ¤ì¼€ì¤„ëŸ¬**: KST 01:00 ì‹¤í–‰ ì‹œ PA ë°ì´í„°/ë¬¸ì œë§Œ ìƒì„±í•˜ë„ë¡ ì¡°ì • (ì¤€ë¹„ ì¤‘ì¸ ìŠ¤íŠ¸ë¦¼ ì œì™¸).
- **ë°ì´í„°ì…‹ ë²„ì „ ê´€ë¦¬**: `dataset_versions` í…Œì´ë¸”ì„ í™•ì¥í•˜ì—¬ ìƒì„± ì¼ì, ë¬¸ì œ ìˆ˜, ì‚¬ìš©ì ìˆ˜, ì‹¤í–‰ ì†Œìš” ì‹œê°„, ìƒíƒœ ë“±ì„ ìƒì„¸ ê¸°ë¡.
- **ê´€ë¦¬ì ì´ë ¥ ë·°**: ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ìµœê·¼ 30ê°œì˜ ë°ì´í„°ì…‹/ë¬¸ì œ ìƒì„± ì´ë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆëŠ” í…Œì´ë¸” ì¶”ê°€.

## ê²€ì¦ ê²°ê³¼
- **ë°±ì—”ë“œ**: Docker ë¹Œë“œ ë° `main.py` ë¡œë“œ í™•ì¸ ì™„ë£Œ.
- **í”„ë¡ íŠ¸ì—”ë“œ**: XP ë°” ë ˆì´ì•„ì›ƒ ë° íˆ´íŒ ë™ì‘ í™•ì¸.
- **ë°ì´í„° (ìš´ì˜)**: `scripts/supabase_test.py`ì— í¬í•¨ëœ ìš´ì˜ í™˜ê²½ DSNì„ í™œìš©í•˜ì—¬, ìƒìš© Supabase ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ ì ‘ì†í•˜ì—¬ ì‹ ê·œ DATE í˜•ì‹ ê¸°ë°˜ ë°ì´í„° ë° ë¬¸ì œ ìƒì„±(Manual Trigger)ì„ ìˆ˜í–‰í•¨.

## í–¥í›„ ê³¼ì œ
- ì±„ì  ì‹œ `expected_result` ì™„ì „ ìºì‹± ë˜ëŠ” DB ìˆ˜ì¤€ ë¹„êµ ë„ì… ê²€í† .
- ìŠ¤íŠ¸ë¦¼ ë¶„ì„ ëª¨ë“œ ì •ì‹ êµ¬í˜„.
=======
# Production DB Fix - Implementation Plan

## ë¬¸ì œ ìš”ì•½

ìƒìš© í™˜ê²½ì—ì„œ ë¬¸ì œ ìƒì„± ì‹œ 2ê°€ì§€ ì˜¤ë¥˜ ë°œìƒ:

1. **`updated_at` ì»¬ëŸ¼ ëˆ„ë½**: `problems` í…Œì´ë¸”ì— `updated_at` ì»¬ëŸ¼ì´ ì—†ì–´ì„œ ëª¨ë“  ë¬¸ì œ ì €ì¥ ì‹¤íŒ¨
2. **SQL ì£¼ì„ ì²˜ë¦¬ ì˜¤ë¥˜**: Geminiê°€ ìƒì„±í•œ ì •ë‹µ SQLì— ì£¼ì„(`--`, `/* */`)ì´ í¬í•¨ëœ ê²½ìš° ì‹¤í–‰ ì˜¤ë¥˜

## í•´ê²° ë°©ë²•

### 1. DB ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜

**ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸**: `backend/migrations/add_problems_updated_at.py`

**ì‹¤í–‰ ë°©ë²•** (ìƒìš© í™˜ê²½):
```bash
# Cloud Run ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰
python3 /app/backend/migrations/add_problems_updated_at.py
```

**ëŒ€ì•ˆ** (Supabase SQL Editor):
```sql
ALTER TABLE public.problems 
ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP DEFAULT NOW();
```

### 2. SQL ì£¼ì„ ì œê±° ë¡œì§ ì¶”ê°€

**ìˆ˜ì •ëœ íŒŒì¼**:
- `problems/generator.py` - PA ë¬¸ì œ ìƒì„±ê¸°
- `problems/generator_stream.py` - Stream ë¬¸ì œ ìƒì„±ê¸°

**ë³€ê²½ ë‚´ìš©**: ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ SQL ì£¼ì„ ì œê±° (`--`, `/* */`)

## ë°°í¬ ì ˆì°¨

### Step 1: ìƒìš© DB ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

> [!WARNING]
> ì½”ë“œ ë°°í¬ ì „ì— ë°˜ë“œì‹œ DB ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë¨¼ì € ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

**Supabase SQL Editorì—ì„œ ì‹¤í–‰ (ê¶Œì¥)**:
```sql
-- updated_at ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE public.problems 
ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP DEFAULT NOW();

-- í™•ì¸
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'problems' AND column_name = 'updated_at';
```

### Step 2: ì½”ë“œ ë³‘í•© ë° ë°°í¬

```bash
# main ë¸Œëœì¹˜ë¡œ ë³‘í•©
git checkout main
git merge dev
git push origin main

# GCP Cloud Buildê°€ ìë™ìœ¼ë¡œ ë°°í¬ ì§„í–‰
```

### Step 3: ê²€ì¦

1. ê´€ë¦¬ì í˜ì´ì§€ ì ‘ì†
2. "ë¬¸ì œ ìƒì„±" ë²„íŠ¼ í´ë¦­
3. ë¡œê·¸ í™•ì¸: `saved 12 problems to DB` ì„±ê³µ ë©”ì‹œì§€ í™•ì¸

## ì˜í–¥ë„

- **Breaking Change**: ì—†ìŒ
- **Downtime**: ì—†ìŒ
- **Rollback**: `ALTER TABLE problems DROP COLUMN updated_at;`

---

**ì‘ì„±ì¼**: 2026-01-08  
**ì‘ì„±ì**: AI Assistant  
**ê´€ë ¨ ì´ìŠˆ**: Production problem generation failures
>>>>>>> a4fa54df2c547471375d00a442adaddba72f8d82
