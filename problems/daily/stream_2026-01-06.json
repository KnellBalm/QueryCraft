[
  {
    "problem_id": "2026-01-06_stream_sql_001",
    "difficulty": "easy",
    "topic": "revenue",
    "requester": "마케팅 팀",
    "question": "2025년 6월 한 달 동안의 일별 총 매출액과 구매 건수를 알려주세요. 결과는 날짜 순으로 정렬해주세요.",
    "context": "마케팅 캠페인의 효과를 일별로 파악하기 위해 2025년 6월의 일별 매출 및 구매 건수 데이터를 요청합니다.",
    "submission_requirements": "결과는 'date', 'revenue', 'purchases' 컬럼으로 구성되어야 하며, 'date' 컬럼을 기준으로 오름차순 정렬되어야 합니다.",
    "answer_sql": "SELECT date, revenue, purchases FROM stream_daily_metrics WHERE date >= '2025-06-01' AND date <= '2025-06-30' ORDER BY date ASC;",
    "expected_columns": [
      "date",
      "revenue",
      "purchases"
    ],
    "sort_keys": [
      "date"
    ],
    "date": "2026-01-06",
    "data_type": "stream",
    "xp_value": 3,
    "expected_result": [
      {
        "date": "2025-06-15",
        "revenue": 100868.0,
        "purchases": 975
      },
      {
        "date": "2025-06-16",
        "revenue": 39477.0,
        "purchases": 377
      },
      {
        "date": "2025-06-17",
        "revenue": 123585.0,
        "purchases": 1217
      },
      {
        "date": "2025-06-18",
        "revenue": 133593.0,
        "purchases": 1322
      },
      {
        "date": "2025-06-19",
        "revenue": 74831.0,
        "purchases": 768
      },
      {
        "date": "2025-06-20",
        "revenue": 121457.0,
        "purchases": 1182
      },
      {
        "date": "2025-06-21",
        "revenue": 126267.0,
        "purchases": 1229
      },
      {
        "date": "2025-06-22",
        "revenue": 69181.0,
        "purchases": 671
      },
      {
        "date": "2025-06-23",
        "revenue": 38903.0,
        "purchases": 394
      },
      {
        "date": "2025-06-24",
        "revenue": 129274.0,
        "purchases": 1258
      },
      {
        "date": "2025-06-25",
        "revenue": 75045.0,
        "purchases": 755
      },
      {
        "date": "2025-06-26",
        "revenue": 83450.0,
        "purchases": 860
      },
      {
        "date": "2025-06-27",
        "revenue": 126719.0,
        "purchases": 1242
      },
      {
        "date": "2025-06-28",
        "revenue": 144989.0,
        "purchases": 1440
      },
      {
        "date": "2025-06-29",
        "revenue": 52590.0,
        "purchases": 498
      },
      {
        "date": "2025-06-30",
        "revenue": 45375.0,
        "purchases": 444
      }
    ],
    "expected_row_count": 16
  },
  {
    "problem_id": "2026-01-06_stream_sql_002",
    "difficulty": "easy",
    "topic": "channel",
    "requester": "그로스 해킹 팀",
    "question": "각 채널별로 총 세션 수가 몇 개인지 집계해주세요. 가장 많은 세션 수를 기록한 채널부터 내림차순으로 정렬해주세요.",
    "context": "어떤 채널이 사용자 트래픽을 가장 많이 유입시키는지 파악하여 채널별 마케팅 전략을 수립하고자 합니다. 각 채널별로 고유한 세션 수를 집계해주세요.",
    "submission_requirements": "결과는 'channel'과 'session_count' 컬럼으로 구성되어야 하며, 'session_count'를 기준으로 내림차순 정렬되어야 합니다.",
    "answer_sql": "SELECT channel, COUNT(DISTINCT session_id) AS session_count FROM stream_events GROUP BY channel ORDER BY session_count DESC;",
    "expected_columns": [
      "channel",
      "session_count"
    ],
    "sort_keys": [
      "session_count"
    ],
    "date": "2026-01-06",
    "data_type": "stream",
    "xp_value": 3,
    "expected_result": [
      {
        "channel": "organic",
        "session_count": 359738
      },
      {
        "channel": "push",
        "session_count": 356690
      },
      {
        "channel": "email",
        "session_count": 354420
      },
      {
        "channel": "ads",
        "session_count": 353458
      }
    ],
    "expected_row_count": 4
  },
  {
    "problem_id": "2026-01-06_stream_sql_003",
    "difficulty": "medium",
    "topic": "funnel",
    "requester": "제품 분석 팀",
    "question": "사용자 퍼널의 각 단계를 거친 사용자 수를 집계해주세요. 단계는 'visit' -> 'view_product' -> 'add_to_cart' -> 'checkout' -> 'purchase' 순서입니다. 각 단계별로 몇 명의 사용자가 도달했는지 알려주세요.",
    "context": "사용자 여정의 병목 구간을 파악하고 개선점을 찾기 위해 핵심 퍼널 단계별 사용자 수를 분석하고 싶습니다. 사용자 ID를 기준으로 각 단계에 도달한 고유 사용자 수를 집계해야 합니다.",
    "submission_requirements": "결과는 'step' (퍼널 단계 이름)과 'user_count' (해당 단계에 도달한 고유 사용자 수) 컬럼으로 구성되어야 합니다. 퍼널 단계 순서('visit', 'view_product', 'add_to_cart', 'checkout', 'purchase')에 따라 결과를 정렬해주세요.",
    "answer_sql": "WITH funnel_steps AS ( SELECT 'visit' AS step, COUNT(DISTINCT user_id) AS user_count FROM stream_events WHERE event_name = 'visit' UNION ALL SELECT 'view_product' AS step, COUNT(DISTINCT user_id) AS user_count FROM stream_events WHERE event_name = 'view_product' UNION ALL SELECT 'add_to_cart' AS step, COUNT(DISTINCT user_id) AS user_count FROM stream_events WHERE event_name = 'add_to_cart' UNION ALL SELECT 'checkout' AS step, COUNT(DISTINCT user_id) AS user_count FROM stream_events WHERE event_name = 'checkout' UNION ALL SELECT 'purchase' AS step, COUNT(DISTINCT user_id) AS user_count FROM stream_events WHERE event_name = 'purchase' ) SELECT fs.step, fs.user_count FROM funnel_steps fs ORDER BY CASE fs.step WHEN 'visit' THEN 1 WHEN 'view_product' THEN 2 WHEN 'add_to_cart' THEN 3 WHEN 'checkout' THEN 4 WHEN 'purchase' THEN 5 END ASC;",
    "expected_columns": [
      "step",
      "user_count"
    ],
    "sort_keys": [
      "step"
    ],
    "date": "2026-01-06",
    "data_type": "stream",
    "xp_value": 5,
    "expected_result": [
      {
        "step": "visit",
        "user_count": 50229
      },
      {
        "step": "view_product",
        "user_count": 50229
      },
      {
        "step": "add_to_cart",
        "user_count": 50220
      },
      {
        "step": "checkout",
        "user_count": 49966
      },
      {
        "step": "purchase",
        "user_count": 49142
      }
    ],
    "expected_row_count": 5
  },
  {
    "problem_id": "2026-01-06_stream_sql_004",
    "difficulty": "medium",
    "topic": "device",
    "requester": "마케팅 분석 팀",
    "question": "각 디바이스별 'purchase' 이벤트 발생률을 계산해주세요. 'purchase' 이벤트가 발생한 세션 수를 해당 디바이스에서 발생한 총 세션 수로 나누어 계산합니다.",
    "context": "어떤 디바이스에서 구매 전환이 더 활발한지 파악하여 디바이스별 최적화 전략을 수립하고자 합니다. 각 디바이스별 구매 전환율을 산출해주세요.",
    "submission_requirements": "결과는 'device'와 'purchase_conversion_rate' 컬럼으로 구성되어야 하며, 'purchase_conversion_rate'를 기준으로 내림차순 정렬되어야 합니다. 소수점 셋째 자리까지 반올림하여 표시해주세요.",
    "answer_sql": "SELECT device, ROUND(SUM(CASE WHEN event_name = 'purchase' THEN 1 ELSE 0 END)::FLOAT / COUNT(DISTINCT session_id), 3) AS purchase_conversion_rate FROM stream_events GROUP BY device ORDER BY purchase_conversion_rate DESC;",
    "expected_columns": [
      "device",
      "purchase_conversion_rate"
    ],
    "sort_keys": [
      "purchase_conversion_rate"
    ],
    "date": "2026-01-06",
    "data_type": "stream",
    "xp_value": 5,
    "expected_result": [],
    "expected_row_count": 0
  },
  {
    "problem_id": "2026-01-06_stream_sql_005",
    "difficulty": "hard",
    "topic": "dau",
    "requester": "데이터 분석 팀",
    "question": "2025년 6월 1일부터 2025년 12월 18일까지의 월별 DAU(Daily Active Users)와 MAU(Monthly Active Users)를 계산해주세요.",
    "context": "월별 사용자 활동 추이를 파악하여 서비스 성장세를 측정하고 향후 예측 모델에 활용하고자 합니다. 월별 DAU와 MAU 값을 정확하게 산출해야 합니다.",
    "submission_requirements": "결과는 'month' (YYYY-MM 형식), 'dau', 'mau' 컬럼으로 구성되어야 합니다. 'month'를 기준으로 오름차순 정렬해주세요. DAU는 해당 월의 일별 고유 사용자 수를 합산한 값이며, MAU는 해당 월의 고유 사용자 수입니다.",
    "answer_sql": "WITH monthly_users AS ( SELECT DATE_TRUNC('month', event_time)::DATE AS month, user_id FROM stream_events WHERE event_time BETWEEN '2025-06-01' AND '2025-12-18' GROUP BY 1, 2 ), daily_active_users AS ( SELECT DATE_TRUNC('day', event_time)::DATE AS day, COUNT(DISTINCT user_id) AS dau_count FROM stream_events WHERE event_time BETWEEN '2025-06-01' AND '2025-12-18' GROUP BY 1 ), monthly_active_users AS ( SELECT DATE_TRUNC('month', event_time)::DATE AS month, COUNT(DISTINCT user_id) AS mau_count FROM stream_events WHERE event_time BETWEEN '2025-06-01' AND '2025-12-18' GROUP BY 1 ) SELECT TO_CHAR(dau.day, 'YYYY-MM') AS month, AVG(dau.dau_count) AS dau, mau.mau_count AS mau FROM daily_active_users dau JOIN monthly_active_users mau ON DATE_TRUNC('month', dau.day) = mau.month WHERE dau.day BETWEEN '2025-06-01' AND '2025-12-18' GROUP BY 1, mau.mau_count ORDER BY month ASC;",
    "expected_columns": [
      "month",
      "dau",
      "mau"
    ],
    "sort_keys": [
      "month"
    ],
    "date": "2026-01-06",
    "data_type": "stream",
    "xp_value": 8,
    "expected_result": [
      {
        "month": "2025-06",
        "dau": 7628.875,
        "mau": 46845
      },
      {
        "month": "2025-07",
        "dau": 6723.387096774193,
        "mau": 49675
      },
      {
        "month": "2025-08",
        "dau": 7971.129032258064,
        "mau": 49996
      },
      {
        "month": "2025-09",
        "dau": 8231.933333333332,
        "mau": 50002
      },
      {
        "month": "2025-10",
        "dau": 7699.387096774193,
        "mau": 49945
      },
      {
        "month": "2025-11",
        "dau": 7234.733333333334,
        "mau": 49808
      },
      {
        "month": "2025-12",
        "dau": 8059.176470588235,
        "mau": 47770
      }
    ],
    "expected_row_count": 7
  },
  {
    "problem_id": "2026-01-06_stream_sql_006",
    "difficulty": "hard",
    "topic": "funnel",
    "requester": "비즈니스 인텔리전스 팀",
    "question": "각 채널별로 'view_product' 이벤트에서 'purchase' 이벤트로 전환하는 전환율을 계산해주세요. 각 채널별로 'view_product' 발생 세션 수 대비 'purchase' 발생 세션 수의 비율로 계산하며, 결과는 소수점 넷째 자리까지 표시해주세요.",
    "context": "어떤 채널이 단순히 트래픽을 유입시키는 것을 넘어 실제 구매까지 이어지는 데 효과적인지 분석하고 싶습니다. 각 채널의 실질적인 구매 기여도를 파악하기 위해 이 전환율을 계산해야 합니다.",
    "submission_requirements": "결과는 'channel', 'view_to_purchase_conversion_rate' 컬럼으로 구성되어야 합니다. 'view_to_purchase_conversion_rate'를 기준으로 내림차순 정렬해주세요. 소수점 넷째 자리까지 표시해야 합니다.",
    "answer_sql": "WITH channel_event_counts AS ( SELECT channel, SUM(CASE WHEN event_name = 'view_product' THEN 1 ELSE 0 END) AS view_count, SUM(CASE WHEN event_name = 'purchase' THEN 1 ELSE 0 END) AS purchase_count FROM stream_events WHERE event_name IN ('view_product', 'purchase') GROUP BY channel ) SELECT cec.channel, CASE WHEN cec.view_count = 0 THEN 0 ELSE ROUND((cec.purchase_count::FLOAT / cec.view_count), 4) END AS view_to_purchase_conversion_rate FROM channel_event_counts cec ORDER BY view_to_purchase_conversion_rate DESC;",
    "expected_columns": [
      "channel",
      "view_to_purchase_conversion_rate"
    ],
    "sort_keys": [
      "view_to_purchase_conversion_rate"
    ],
    "date": "2026-01-06",
    "data_type": "stream",
    "xp_value": 8,
    "expected_result": [],
    "expected_row_count": 0
  }
]