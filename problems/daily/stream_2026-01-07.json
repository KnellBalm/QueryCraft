[
  {
    "problem_id": "2026-01-07_stream_sql_001",
    "difficulty": "easy",
    "topic": "revenue",
    "requester": "마케팅 팀",
    "question": "2025년 6월부터 12월까지의 일별 매출액과 구매 건수를 조회해주세요. 각 날짜별로 매출액과 구매 건수를 확인할 수 있어야 합니다.",
    "context": "매출 및 구매 데이터의 일별 추이를 파악하여 마케팅 캠페인 효과를 측정하고 싶습니다.",
    "submission_requirements": "결과는 'date' (날짜), 'revenue' (매출액), 'purchases' (구매 건수) 순서로 조회하며, 날짜 순으로 정렬해주세요.",
    "answer_sql": "SELECT date, revenue, purchases FROM stream_daily_metrics WHERE date BETWEEN '2025-06-01' AND '2025-12-31' ORDER BY date ASC;",
    "expected_columns": [
      "date",
      "revenue",
      "purchases"
    ],
    "sort_keys": [
      "date"
    ],
    "hint": "stream_daily_metrics 테이블에서 date, revenue, purchases 컬럼을 선택하고, 날짜 범위를 지정하여 조회하세요.",
    "date": "2026-01-07",
    "data_type": "stream",
    "xp_value": 3,
    "expected_result": [
      {
        "date": "2025-06-15",
        "revenue": 100868.0,
        "purchases": 975
      },
      {
        "date": "2025-06-16",
        "revenue": 39477.0,
        "purchases": 377
      },
      {
        "date": "2025-06-17",
        "revenue": 123585.0,
        "purchases": 1217
      },
      {
        "date": "2025-06-18",
        "revenue": 133593.0,
        "purchases": 1322
      },
      {
        "date": "2025-06-19",
        "revenue": 74831.0,
        "purchases": 768
      },
      {
        "date": "2025-06-20",
        "revenue": 121457.0,
        "purchases": 1182
      },
      {
        "date": "2025-06-21",
        "revenue": 126267.0,
        "purchases": 1229
      },
      {
        "date": "2025-06-22",
        "revenue": 69181.0,
        "purchases": 671
      },
      {
        "date": "2025-06-23",
        "revenue": 38903.0,
        "purchases": 394
      },
      {
        "date": "2025-06-24",
        "revenue": 129274.0,
        "purchases": 1258
      },
      {
        "date": "2025-06-25",
        "revenue": 75045.0,
        "purchases": 755
      },
      {
        "date": "2025-06-26",
        "revenue": 83450.0,
        "purchases": 860
      },
      {
        "date": "2025-06-27",
        "revenue": 126719.0,
        "purchases": 1242
      },
      {
        "date": "2025-06-28",
        "revenue": 144989.0,
        "purchases": 1440
      },
      {
        "date": "2025-06-29",
        "revenue": 52590.0,
        "purchases": 498
      },
      {
        "date": "2025-06-30",
        "revenue": 45375.0,
        "purchases": 444
      },
      {
        "date": "2025-07-01",
        "revenue": 96495.0,
        "purchases": 936
      },
      {
        "date": "2025-07-02",
        "revenue": 94429.0,
        "purchases": 922
      },
      {
        "date": "2025-07-03",
        "revenue": 79259.0,
        "purchases": 747
      },
      {
        "date": "2025-07-04",
        "revenue": 220912.0,
        "purchases": 2184
      },
      {
        "date": "2025-07-05",
        "revenue": 103279.0,
        "purchases": 1001
      },
      {
        "date": "2025-07-06",
        "revenue": 107436.0,
        "purchases": 1059
      },
      {
        "date": "2025-07-07",
        "revenue": 136918.0,
        "purchases": 1321
      },
      {
        "date": "2025-07-08",
        "revenue": 76517.0,
        "purchases": 771
      },
      {
        "date": "2025-07-09",
        "revenue": 52766.0,
        "purchases": 486
      },
      {
        "date": "2025-07-10",
        "revenue": 124939.0,
        "purchases": 1251
      },
      {
        "date": "2025-07-11",
        "revenue": 79257.0,
        "purchases": 783
      },
      {
        "date": "2025-07-12",
        "revenue": 43548.0,
        "purchases": 415
      },
      {
        "date": "2025-07-13",
        "revenue": 399064.0,
        "purchases": 3865
      },
      {
        "date": "2025-07-14",
        "revenue": 83110.0,
        "purchases": 813
      },
      {
        "date": "2025-07-15",
        "revenue": 51099.0,
        "purchases": 519
      },
      {
        "date": "2025-07-16",
        "revenue": 429946.0,
        "purchases": 4177
      },
      {
        "date": "2025-07-17",
        "revenue": 58011.0,
        "purchases": 568
      },
      {
        "date": "2025-07-18",
        "revenue": 60767.0,
        "purchases": 595
      },
      {
        "date": "2025-07-19",
        "revenue": 93925.0,
        "purchases": 881
      },
      {
        "date": "2025-07-20",
        "revenue": 68472.0,
        "purchases": 635
      },
      {
        "date": "2025-07-21",
        "revenue": 48445.0,
        "purchases": 472
      },
      {
        "date": "2025-07-22",
        "revenue": 87237.0,
        "purchases": 843
      },
      {
        "date": "2025-07-23",
        "revenue": 141779.0,
        "purchases": 1402
      },
      {
        "date": "2025-07-24",
        "revenue": 43947.0,
        "purchases": 425
      },
      {
        "date": "2025-07-25",
        "revenue": 77374.0,
        "purchases": 762
      },
      {
        "date": "2025-07-26",
        "revenue": 111585.0,
        "purchases": 1091
      },
      {
        "date": "2025-07-27",
        "revenue": 44165.0,
        "purchases": 428
      },
      {
        "date": "2025-07-28",
        "revenue": 109134.0,
        "purchases": 1076
      },
      {
        "date": "2025-07-29",
        "revenue": 37316.0,
        "purchases": 367
      },
      {
        "date": "2025-07-30",
        "revenue": 56918.0,
        "purchases": 549
      },
      {
        "date": "2025-07-31",
        "revenue": 147467.0,
        "purchases": 1461
      },
      {
        "date": "2025-08-01",
        "revenue": 130577.0,
        "purchases": 1281
      },
      {
        "date": "2025-08-02",
        "revenue": 96009.0,
        "purchases": 974
      },
      {
        "date": "2025-08-03",
        "revenue": 70488.0,
        "purchases": 681
      },
      {
        "date": "2025-08-04",
        "revenue": 120227.0,
        "purchases": 1200
      },
      {
        "date": "2025-08-05",
        "revenue": 100970.0,
        "purchases": 987
      },
      {
        "date": "2025-08-06",
        "revenue": 128573.0,
        "purchases": 1249
      },
      {
        "date": "2025-08-07",
        "revenue": 53549.0,
        "purchases": 546
      },
      {
        "date": "2025-08-08",
        "revenue": 141442.0,
        "purchases": 1416
      },
      {
        "date": "2025-08-09",
        "revenue": 58828.0,
        "purchases": 557
      },
      {
        "date": "2025-08-10",
        "revenue": 111390.0,
        "purchases": 1067
      },
      {
        "date": "2025-08-11",
        "revenue": 145257.0,
        "purchases": 1415
      },
      {
        "date": "2025-08-12",
        "revenue": 53339.0,
        "purchases": 540
      },
      {
        "date": "2025-08-13",
        "revenue": 56945.0,
        "purchases": 567
      },
      {
        "date": "2025-08-14",
        "revenue": 50474.0,
        "purchases": 502
      },
      {
        "date": "2025-08-15",
        "revenue": 142819.0,
        "purchases": 1412
      },
      {
        "date": "2025-08-16",
        "revenue": 137907.0,
        "purchases": 1343
      },
      {
        "date": "2025-08-17",
        "revenue": 41358.0,
        "purchases": 404
      },
      {
        "date": "2025-08-18",
        "revenue": 100851.0,
        "purchases": 1005
      },
      {
        "date": "2025-08-19",
        "revenue": 127205.0,
        "purchases": 1262
      },
      {
        "date": "2025-08-20",
        "revenue": 86452.0,
        "purchases": 869
      },
      {
        "date": "2025-08-21",
        "revenue": 89541.0,
        "purchases": 856
      },
      {
        "date": "2025-08-22",
        "revenue": 81659.0,
        "purchases": 812
      },
      {
        "date": "2025-08-23",
        "revenue": 138429.0,
        "purchases": 1378
      },
      {
        "date": "2025-08-24",
        "revenue": 128011.0,
        "purchases": 1239
      },
      {
        "date": "2025-08-25",
        "revenue": 120523.0,
        "purchases": 1195
      },
      {
        "date": "2025-08-26",
        "revenue": 56057.0,
        "purchases": 528
      },
      {
        "date": "2025-08-27",
        "revenue": 118355.0,
        "purchases": 1174
      },
      {
        "date": "2025-08-28",
        "revenue": 129581.0,
        "purchases": 1228
      },
      {
        "date": "2025-08-29",
        "revenue": 60044.0,
        "purchases": 610
      },
      {
        "date": "2025-08-30",
        "revenue": 87702.0,
        "purchases": 883
      },
      {
        "date": "2025-08-31",
        "revenue": 43086.0,
        "purchases": 414
      },
      {
        "date": "2025-09-01",
        "revenue": 319000.0,
        "purchases": 3062
      },
      {
        "date": "2025-09-02",
        "revenue": 46674.0,
        "purchases": 457
      },
      {
        "date": "2025-09-03",
        "revenue": 111530.0,
        "purchases": 1081
      },
      {
        "date": "2025-09-04",
        "revenue": 115174.0,
        "purchases": 1109
      },
      {
        "date": "2025-09-05",
        "revenue": 48444.0,
        "purchases": 476
      },
      {
        "date": "2025-09-06",
        "revenue": 136729.0,
        "purchases": 1317
      },
      {
        "date": "2025-09-07",
        "revenue": 127274.0,
        "purchases": 1237
      },
      {
        "date": "2025-09-08",
        "revenue": 63312.0,
        "purchases": 619
      },
      {
        "date": "2025-09-09",
        "revenue": 99890.0,
        "purchases": 992
      },
      {
        "date": "2025-09-10",
        "revenue": 97268.0,
        "purchases": 991
      },
      {
        "date": "2025-09-11",
        "revenue": 143499.0,
        "purchases": 1383
      },
      {
        "date": "2025-09-12",
        "revenue": 115407.0,
        "purchases": 1126
      },
      {
        "date": "2025-09-13",
        "revenue": 65806.0,
        "purchases": 640
      },
      {
        "date": "2025-09-14",
        "revenue": 77921.0,
        "purchases": 728
      },
      {
        "date": "2025-09-15",
        "revenue": 55471.0,
        "purchases": 542
      },
      {
        "date": "2025-09-16",
        "revenue": 146145.0,
        "purchases": 1392
      },
      {
        "date": "2025-09-17",
        "revenue": 119486.0,
        "purchases": 1153
      },
      {
        "date": "2025-09-18",
        "revenue": 64077.0,
        "purchases": 621
      },
      {
        "date": "2025-09-19",
        "revenue": 68682.0,
        "purchases": 663
      },
      {
        "date": "2025-09-20",
        "revenue": 83769.0,
        "purchases": 792
      },
      {
        "date": "2025-09-21",
        "revenue": 139054.0,
        "purchases": 1342
      },
      {
        "date": "2025-09-22",
        "revenue": 82128.0,
        "purchases": 812
      },
      {
        "date": "2025-09-23",
        "revenue": 382597.0,
        "purchases": 3662
      },
      {
        "date": "2025-09-24",
        "revenue": 105616.0,
        "purchases": 1049
      },
      {
        "date": "2025-09-25",
        "revenue": 119784.0,
        "purchases": 1204
      },
      {
        "date": "2025-09-26",
        "revenue": 115187.0,
        "purchases": 1115
      },
      {
        "date": "2025-09-27",
        "revenue": 43080.0,
        "purchases": 423
      },
      {
        "date": "2025-09-28",
        "revenue": 135305.0,
        "purchases": 1295
      },
      {
        "date": "2025-09-29",
        "revenue": 133832.0,
        "purchases": 1297
      },
      {
        "date": "2025-09-30",
        "revenue": 132420.0,
        "purchases": 1309
      },
      {
        "date": "2025-10-01",
        "revenue": 118091.0,
        "purchases": 1159
      },
      {
        "date": "2025-10-02",
        "revenue": 126171.0,
        "purchases": 1265
      },
      {
        "date": "2025-10-03",
        "revenue": 103289.0,
        "purchases": 1015
      },
      {
        "date": "2025-10-04",
        "revenue": 53296.0,
        "purchases": 533
      },
      {
        "date": "2025-10-05",
        "revenue": 61110.0,
        "purchases": 587
      },
      {
        "date": "2025-10-06",
        "revenue": 85584.0,
        "purchases": 821
      },
      {
        "date": "2025-10-07",
        "revenue": 50307.0,
        "purchases": 510
      },
      {
        "date": "2025-10-08",
        "revenue": 46421.0,
        "purchases": 450
      },
      {
        "date": "2025-10-09",
        "revenue": 111900.0,
        "purchases": 1067
      },
      {
        "date": "2025-10-10",
        "revenue": 132885.0,
        "purchases": 1323
      },
      {
        "date": "2025-10-11",
        "revenue": 41557.0,
        "purchases": 405
      },
      {
        "date": "2025-10-12",
        "revenue": 109433.0,
        "purchases": 1049
      },
      {
        "date": "2025-10-13",
        "revenue": 41400.0,
        "purchases": 410
      },
      {
        "date": "2025-10-14",
        "revenue": 101575.0,
        "purchases": 975
      },
      {
        "date": "2025-10-15",
        "revenue": 68991.0,
        "purchases": 695
      },
      {
        "date": "2025-10-16",
        "revenue": 128729.0,
        "purchases": 1263
      },
      {
        "date": "2025-10-17",
        "revenue": 75262.0,
        "purchases": 749
      },
      {
        "date": "2025-10-18",
        "revenue": 138384.0,
        "purchases": 1384
      },
      {
        "date": "2025-10-19",
        "revenue": 140886.0,
        "purchases": 1369
      },
      {
        "date": "2025-10-20",
        "revenue": 75793.0,
        "purchases": 737
      },
      {
        "date": "2025-10-21",
        "revenue": 108133.0,
        "purchases": 1052
      },
      {
        "date": "2025-10-22",
        "revenue": 138579.0,
        "purchases": 1339
      },
      {
        "date": "2025-10-23",
        "revenue": 51044.0,
        "purchases": 507
      },
      {
        "date": "2025-10-24",
        "revenue": 119781.0,
        "purchases": 1165
      },
      {
        "date": "2025-10-25",
        "revenue": 56713.0,
        "purchases": 551
      },
      {
        "date": "2025-10-26",
        "revenue": 36604.0,
        "purchases": 373
      },
      {
        "date": "2025-10-27",
        "revenue": 136132.0,
        "purchases": 1318
      },
      {
        "date": "2025-10-28",
        "revenue": 139772.0,
        "purchases": 1367
      },
      {
        "date": "2025-10-29",
        "revenue": 91080.0,
        "purchases": 881
      },
      {
        "date": "2025-10-30",
        "revenue": 109545.0,
        "purchases": 1101
      },
      {
        "date": "2025-10-31",
        "revenue": 114150.0,
        "purchases": 1120
      },
      {
        "date": "2025-11-01",
        "revenue": 119649.0,
        "purchases": 1223
      },
      {
        "date": "2025-11-02",
        "revenue": 72709.0,
        "purchases": 710
      },
      {
        "date": "2025-11-03",
        "revenue": 48019.0,
        "purchases": 471
      },
      {
        "date": "2025-11-04",
        "revenue": 127679.0,
        "purchases": 1249
      },
      {
        "date": "2025-11-05",
        "revenue": 114884.0,
        "purchases": 1095
      },
      {
        "date": "2025-11-06",
        "revenue": 129954.0,
        "purchases": 1279
      },
      {
        "date": "2025-11-07",
        "revenue": 239110.0,
        "purchases": 2359
      },
      {
        "date": "2025-11-08",
        "revenue": 36983.0,
        "purchases": 353
      },
      {
        "date": "2025-11-09",
        "revenue": 409120.0,
        "purchases": 3994
      },
      {
        "date": "2025-11-10",
        "revenue": 46836.0,
        "purchases": 442
      },
      {
        "date": "2025-11-11",
        "revenue": 49322.0,
        "purchases": 456
      },
      {
        "date": "2025-11-12",
        "revenue": 133571.0,
        "purchases": 1292
      },
      {
        "date": "2025-11-13",
        "revenue": 57553.0,
        "purchases": 556
      },
      {
        "date": "2025-11-14",
        "revenue": 382103.0,
        "purchases": 3768
      },
      {
        "date": "2025-11-15",
        "revenue": 70848.0,
        "purchases": 680
      },
      {
        "date": "2025-11-16",
        "revenue": 96129.0,
        "purchases": 940
      },
      {
        "date": "2025-11-17",
        "revenue": 46984.0,
        "purchases": 457
      },
      {
        "date": "2025-11-18",
        "revenue": 114063.0,
        "purchases": 1115
      },
      {
        "date": "2025-11-19",
        "revenue": 66735.0,
        "purchases": 641
      },
      {
        "date": "2025-11-20",
        "revenue": 112151.0,
        "purchases": 1098
      },
      {
        "date": "2025-11-21",
        "revenue": 63553.0,
        "purchases": 622
      },
      {
        "date": "2025-11-22",
        "revenue": 60914.0,
        "purchases": 596
      },
      {
        "date": "2025-11-23",
        "revenue": 117205.0,
        "purchases": 1123
      },
      {
        "date": "2025-11-24",
        "revenue": 43780.0,
        "purchases": 447
      },
      {
        "date": "2025-11-25",
        "revenue": 96037.0,
        "purchases": 938
      },
      {
        "date": "2025-11-26",
        "revenue": 85168.0,
        "purchases": 838
      },
      {
        "date": "2025-11-27",
        "revenue": 93845.0,
        "purchases": 927
      },
      {
        "date": "2025-11-28",
        "revenue": 60001.0,
        "purchases": 589
      },
      {
        "date": "2025-11-29",
        "revenue": 145290.0,
        "purchases": 1389
      },
      {
        "date": "2025-11-30",
        "revenue": 115591.0,
        "purchases": 1126
      },
      {
        "date": "2025-12-01",
        "revenue": 91572.0,
        "purchases": 869
      },
      {
        "date": "2025-12-02",
        "revenue": 119053.0,
        "purchases": 1160
      },
      {
        "date": "2025-12-03",
        "revenue": 112937.0,
        "purchases": 1104
      },
      {
        "date": "2025-12-04",
        "revenue": 106328.0,
        "purchases": 1027
      },
      {
        "date": "2025-12-05",
        "revenue": 135693.0,
        "purchases": 1309
      },
      {
        "date": "2025-12-06",
        "revenue": 95899.0,
        "purchases": 944
      },
      {
        "date": "2025-12-07",
        "revenue": 105095.0,
        "purchases": 1017
      },
      {
        "date": "2025-12-08",
        "revenue": 104845.0,
        "purchases": 977
      },
      {
        "date": "2025-12-09",
        "revenue": 107341.0,
        "purchases": 1016
      },
      {
        "date": "2025-12-10",
        "revenue": 40118.0,
        "purchases": 384
      },
      {
        "date": "2025-12-11",
        "revenue": 58738.0,
        "purchases": 566
      },
      {
        "date": "2025-12-12",
        "revenue": 73593.0,
        "purchases": 701
      },
      {
        "date": "2025-12-13",
        "revenue": 125797.0,
        "purchases": 1196
      },
      {
        "date": "2025-12-14",
        "revenue": 144469.0,
        "purchases": 1410
      },
      {
        "date": "2025-12-15",
        "revenue": 51539.0,
        "purchases": 526
      },
      {
        "date": "2025-12-16",
        "revenue": 116920.0,
        "purchases": 1136
      },
      {
        "date": "2025-12-17",
        "revenue": 107107.0,
        "purchases": 1036
      },
      {
        "date": "2025-12-18",
        "revenue": 92949.0,
        "purchases": 913
      }
    ],
    "expected_row_count": 187
  },
  {
    "problem_id": "2026-01-07_stream_sql_002",
    "difficulty": "easy",
    "topic": "channel",
    "requester": "그로스 해킹 팀",
    "question": "각 광고 채널별로 발생한 총 이벤트 수를 집계해주세요. 어떤 채널에서 가장 많은 사용자의 활동이 있었는지 확인하고 싶습니다.",
    "context": "주요 광고 채널별 사용자 참여도를 파악하여 효율적인 채널 운영 전략을 수립하고자 합니다.",
    "submission_requirements": "결과는 'channel' (채널명)과 'total_events' (총 이벤트 수) 컬럼으로 제공하며, 총 이벤트 수가 많은 순서대로 정렬해주세요.",
    "answer_sql": "SELECT channel, COUNT(*) AS total_events FROM stream_events GROUP BY channel ORDER BY total_events DESC;",
    "expected_columns": [
      "channel",
      "total_events"
    ],
    "sort_keys": [
      "total_events"
    ],
    "hint": "stream_events 테이블에서 channel 별로 그룹화하고 COUNT(*) 함수를 사용하여 총 이벤트 수를 계산하세요.",
    "date": "2026-01-07",
    "data_type": "stream",
    "xp_value": 3,
    "expected_result": [
      {
        "channel": "organic",
        "total_events": 903775
      },
      {
        "channel": "push",
        "total_events": 896116
      },
      {
        "channel": "email",
        "total_events": 891088
      },
      {
        "channel": "ads",
        "total_events": 887909
      }
    ],
    "expected_row_count": 4
  },
  {
    "problem_id": "2026-01-07_stream_sql_003",
    "difficulty": "medium",
    "topic": "funnel",
    "requester": "퍼포먼스 마케팅 팀",
    "question": "사용자가 'view_product' 이벤트 이후 'add_to_cart' 이벤트로 전환하는 비율을 계산해주세요. 이 비율은 2025년 11월 1일부터 12월 18일까지의 데이터에 대해서만 집계해야 합니다.",
    "context": "제품 상세 페이지 조회 후 장바구니에 담는 전환율을 분석하여 제품 페이지의 매력도 및 전환 과정에서의 문제점을 파악하고 싶습니다.",
    "submission_requirements": "결과는 'conversion_rate' (전환율) 컬럼 하나로 제공하며, 소수점 4자리까지 표시해주세요.",
    "answer_sql": "WITH funnel_steps AS (\n  SELECT\n    session_id,\n    MAX(CASE WHEN event_name = 'view_product' THEN 1 ELSE 0 END) AS viewed_product,\n    MAX(CASE WHEN event_name = 'add_to_cart' THEN 1 ELSE 0 END) AS added_to_cart\n  FROM stream_events\n  WHERE\n    event_time BETWEEN '2025-11-01 00:00:00' AND '2025-12-18 23:59:59'\n  GROUP BY session_id\n)\nSELECT\n  (SUM(added_to_cart)::FLOAT / SUM(viewed_product)::FLOAT) * 100 AS conversion_rate\nFROM funnel_steps\nWHERE viewed_product = 1;",
    "expected_columns": [
      "conversion_rate"
    ],
    "sort_keys": [],
    "hint": "session_id 별로 view_product와 add_to_cart 이벤트 발생 여부를 파악한 후, 두 단계 간의 전환율을 계산하세요. 날짜 조건을 잊지 마세요.",
    "date": "2026-01-07",
    "data_type": "stream",
    "xp_value": 5,
    "expected_result": [
      {
        "conversion_rate": 29.862058138138874
      }
    ],
    "expected_row_count": 1
  },
  {
    "problem_id": "2026-01-07_stream_sql_004",
    "difficulty": "medium",
    "topic": "device",
    "requester": "UX/UI 팀",
    "question": "각 디바이스 유형별로 'add_to_cart' 이벤트에서 'purchase' 이벤트로의 전환율을 계산해주세요. 2025년 10월 1일부터 11월 30일까지의 데이터를 사용합니다.",
    "context": "사용자가 주로 사용하는 디바이스별로 구매 전환 과정을 분석하여 해당 디바이스에 최적화된 사용자 경험을 제공하고자 합니다.",
    "submission_requirements": "결과는 'device' (디바이스 종류)와 'purchase_conversion_rate' (구매 전환율) 컬럼으로 제공하며, 구매 전환율이 높은 순서대로 정렬해주세요. 전환율은 소수점 3자리까지 표시합니다.",
    "answer_sql": "WITH device_funnel AS (\n  SELECT\n    se.device,\n    COUNT(DISTINCT CASE WHEN se.event_name = 'add_to_cart' THEN se.session_id ELSE NULL END) AS add_to_cart_sessions,\n    COUNT(DISTINCT CASE WHEN se.event_name = 'purchase' THEN se.session_id ELSE NULL END) AS purchase_sessions\n  FROM stream_events se\n  WHERE\n    se.event_time BETWEEN '2025-10-01 00:00:00' AND '2025-11-30 23:59:59'\n    AND se.event_name IN ('add_to_cart', 'purchase')\n  GROUP BY se.device\n)\nSELECT\n  device,\n  CASE\n    WHEN add_to_cart_sessions = 0 THEN 0.0\n    ELSE (purchase_sessions::FLOAT / add_to_cart_sessions::FLOAT) * 100\n  END AS purchase_conversion_rate\nFROM device_funnel\nORDER BY purchase_conversion_rate DESC;",
    "expected_columns": [
      "device",
      "purchase_conversion_rate"
    ],
    "sort_keys": [
      "purchase_conversion_rate"
    ],
    "hint": "디바이스별로 add_to_cart 이벤트 세션 수와 purchase 이벤트 세션 수를 집계하고, 이를 기반으로 전환율을 계산하세요. 0으로 나누는 경우를 방지해야 합니다.",
    "date": "2026-01-07",
    "data_type": "stream",
    "xp_value": 5,
    "expected_result": [
      {
        "device": "ios",
        "purchase_conversion_rate": 45.45313881520778
      },
      {
        "device": "android",
        "purchase_conversion_rate": 44.95942847062974
      },
      {
        "device": "web",
        "purchase_conversion_rate": 44.94977370570703
      }
    ],
    "expected_row_count": 3
  },
  {
    "problem_id": "2026-01-07_stream_sql_005",
    "difficulty": "hard",
    "topic": "dau",
    "requester": "데이터 분석 팀",
    "question": "2025년 7월 1일부터 8월 31일까지의 일별 활성 사용자 수(DAU)를 계산하고, 이 기간 동안의 월간 활성 사용자 수(MAU) 또한 함께 산출해주세요. DAU는 특정 날짜에 활동한 고유 사용자 수를 의미하며, MAU는 해당 월에 한 번이라도 활동한 고유 사용자 수를 의미합니다.",
    "context": "서비스의 사용자 활동성을 다각도로 분석하기 위해 일별 및 월간 활성 사용자 지표를 파악하고 싶습니다.",
    "submission_requirements": "결과는 'date' (날짜), 'dau' (일별 활성 사용자 수), 'mau_july' (7월 MAU), 'mau_august' (8월 MAU) 컬럼으로 제공하며, 날짜 순으로 정렬해주세요. MAU는 각 행에 동일하게 표시됩니다.",
    "answer_sql": "WITH daily_active_users AS (\n  SELECT\n    DATE(event_time) AS activity_date,\n    COUNT(DISTINCT user_id) AS dau\n  FROM stream_events\n  WHERE event_time BETWEEN '2025-07-01 00:00:00' AND '2025-08-31 23:59:59'\n  GROUP BY activity_date\n),\nmonthly_active_users AS (\n  SELECT\n    '2025-07-01' AS month_start_date,\n    COUNT(DISTINCT user_id) AS mau\n  FROM stream_events\n  WHERE event_time BETWEEN '2025-07-01 00:00:00' AND '2025-07-31 23:59:59'\n  UNION ALL\n  SELECT\n    '2025-08-01' AS month_start_date,\n    COUNT(DISTINCT user_id) AS mau\n  FROM stream_events\n  WHERE event_time BETWEEN '2025-08-01 00:00:00' AND '2025-08-31 23:59:59'\n)\nSELECT\n  dau_data.activity_date AS date,\n  dau_data.dau,\n  COALESCE(mau_july.mau, 0) AS mau_july,\n  COALESCE(mau_august.mau, 0) AS mau_august\nFROM daily_active_users dau_data\nLEFT JOIN monthly_active_users mau_july ON mau_july.month_start_date = '2025-07-01'\nLEFT JOIN monthly_active_users mau_august ON mau_august.month_start_date = '2025-08-01'\nWHERE\n  dau_data.activity_date BETWEEN '2025-07-01' AND '2025-08-31'\nORDER BY\n  dau_data.activity_date ASC;",
    "expected_columns": [
      "date",
      "dau",
      "mau_july",
      "mau_august"
    ],
    "sort_keys": [
      "date"
    ],
    "hint": "먼저 일별로 고유 사용자 수를 집계하여 DAU를 구하고, 별도로 7월과 8월의 고유 사용자 수를 집계하여 MAU를 구한 후, 두 결과를 조인하여 최종 결과를 만드세요.",
    "date": "2026-01-07",
    "data_type": "stream",
    "xp_value": 8,
    "expected_result": [
      {
        "date": "2025-07-01",
        "dau": 7603,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-02",
        "dau": 7761,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-03",
        "dau": 6278,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-04",
        "dau": 6052,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-05",
        "dau": 8090,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-06",
        "dau": 8597,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-07",
        "dau": 11147,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-08",
        "dau": 6639,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-09",
        "dau": 3966,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-10",
        "dau": 10436,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-11",
        "dau": 6665,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-12",
        "dau": 3463,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-13",
        "dau": 10646,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-14",
        "dau": 6453,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-15",
        "dau": 4351,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-16",
        "dau": 11487,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-17",
        "dau": 4689,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-18",
        "dau": 5177,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-19",
        "dau": 7181,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-20",
        "dau": 5356,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-21",
        "dau": 4131,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-22",
        "dau": 6857,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-23",
        "dau": 11993,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-24",
        "dau": 3783,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-25",
        "dau": 6105,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-26",
        "dau": 8777,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-27",
        "dau": 3483,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-28",
        "dau": 9473,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-29",
        "dau": 3010,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-30",
        "dau": 4629,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-07-31",
        "dau": 4147,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-01",
        "dau": 10440,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-02",
        "dau": 8272,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-03",
        "dau": 5843,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-04",
        "dau": 10028,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-05",
        "dau": 8529,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-06",
        "dau": 10710,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-07",
        "dau": 4413,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-08",
        "dau": 11889,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-09",
        "dau": 4762,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-10",
        "dau": 9048,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-11",
        "dau": 11148,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-12",
        "dau": 4551,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-13",
        "dau": 4751,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-14",
        "dau": 3957,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-15",
        "dau": 11602,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-16",
        "dau": 11307,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-17",
        "dau": 3294,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-18",
        "dau": 8345,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-19",
        "dau": 10412,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-20",
        "dau": 7194,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-21",
        "dau": 7167,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-22",
        "dau": 6849,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-23",
        "dau": 11592,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-24",
        "dau": 10199,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-25",
        "dau": 10112,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-26",
        "dau": 4520,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-27",
        "dau": 9815,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-28",
        "dau": 10432,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-29",
        "dau": 4969,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-30",
        "dau": 7399,
        "mau_july": 49675,
        "mau_august": 49996
      },
      {
        "date": "2025-08-31",
        "dau": 3556,
        "mau_july": 49675,
        "mau_august": 49996
      }
    ],
    "expected_row_count": 62
  },
  {
    "problem_id": "2026-01-07_stream_sql_006",
    "difficulty": "hard",
    "topic": "funnel",
    "requester": "마케팅 분석가",
    "question": "사용자별로 'visit' 이벤트부터 'purchase' 이벤트까지의 총 단계 수를 계산하고, 각 단계 수별로 얼마나 많은 사용자가 존재하는지 집계해주세요. 2025년 11월 1일부터 12월 18일까지의 데이터에 대해서만 분석합니다.",
    "context": "사용자의 구매 여정 단계를 세분화하여 분석하고, 특정 단계에서 이탈이 많이 발생하는지 파악하여 개선점을 찾고자 합니다.",
    "submission_requirements": "결과는 'steps_to_purchase' (구매까지의 총 단계 수)와 'user_count' (해당 단계 수를 가진 사용자 수) 컬럼으로 제공하며, 'steps_to_purchase' 기준으로 오름차순 정렬해주세요.",
    "answer_sql": "WITH user_event_sequence AS (\n  SELECT\n    user_id,\n    session_id,\n    event_name,\n    event_time,\n    ROW_NUMBER() OVER (PARTITION BY user_id, session_id ORDER BY event_time) as rn\n  FROM stream_events\n  WHERE event_time BETWEEN '2025-11-01 00:00:00' AND '2025-12-18 23:59:59'\n    AND event_name IN ('visit', 'view_product', 'add_to_cart', 'checkout', 'purchase')\n),\nuser_purchase_path AS (\n  SELECT\n    user_id,\n    session_id,\n    COUNT(event_name) as steps_to_purchase\n  FROM user_event_sequence\n  WHERE event_name = 'purchase'\n  GROUP BY user_id, session_id\n)\nSELECT\n  steps_to_purchase,\n  COUNT(DISTINCT user_id) AS user_count\nFROM user_purchase_path\nGROUP BY steps_to_purchase\nORDER BY steps_to_purchase ASC;",
    "expected_columns": [
      "steps_to_purchase",
      "user_count"
    ],
    "sort_keys": [
      "steps_to_purchase"
    ],
    "hint": "각 사용자의 세션별 이벤트 순서를 파악하고, 구매 이벤트가 발생한 세션에 대해 이벤트 수를 세어 '구매까지의 단계 수'를 구하세요. 이후 해당 단계 수를 가진 사용자 수를 집계합니다.",
    "date": "2026-01-07",
    "data_type": "stream",
    "xp_value": 8,
    "expected_result": [
      {
        "steps_to_purchase": 1,
        "user_count": 31995
      }
    ],
    "expected_row_count": 1
  }
]